<!DOCTYPE html>
<html lang="en">
<head>
	<title>three.js webgl - shaders - ocean</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link type="text/css" rel="stylesheet" href="../../main.css">
</head>
<body>

<div id="container"></div>
<div id="info">
	<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - webgl ocean
</div>

<script type="module">

	import Stats from '../../jsm/libs/stats.module.js';
	import {GUI} from '../../jsm/libs/dat.gui.module.js';

	import * as THREE from '../../../build/three_r125.module.js';
	import {OrbitControls} from '../../jsm/controls/r125/OrbitControls.js';
	import {Water} from '../../jsm/objects/r125/Water.js';
	import {Sky} from '../../jsm/objects/r125/Sky.js';

	let container, stats;
	let camera, scene, renderer, light;
	let controls, water, sun, mesh;

	init();
	animate();

	function init() {

		container = document.getElementById('container');

		renderer = new THREE.WebGLRenderer();
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);
		container.appendChild(renderer.domElement);

		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 1, 20000);
		camera.position.set(30, 30, 100);

		sun = new THREE.Vector3();

		// Water
		const waterGeometry = new THREE.PlaneGeometry(100, 100);

		water = new Water(waterGeometry, {
			textureWidth: 512,
			textureHeight: 512,
			waterNormals: new THREE.TextureLoader().load('../../textures/waternormals.jpg', function (texture) {
				texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
			}),
			alpha: 1.0,
			sunDirection: new THREE.Vector3(),
			// sunColor: 0xffffff,
			waterColor: 0x48828e,
			distortionScale: 3.7,
			fog: scene.fog !== undefined
		});
		water.rotation.x = -Math.PI / 2;
		scene.add(water);

		//
		controls = new OrbitControls(camera, renderer.domElement);
		controls.maxPolarAngle = Math.PI * 0.495;
		controls.target.set(0, 10, 0);
		controls.minDistance = 40.0;
		controls.maxDistance = 200.0;
		controls.update();

		//
		stats = new Stats();
		container.appendChild(stats.dom);

		// GUI
		const gui = new GUI();

		const waterUniforms = water.material.uniforms;

		const folderWater = gui.addFolder('Water');
		folderWater.add(waterUniforms.distortionScale, 'value', 0, 8, 0.1).name('distortionScale');
		folderWater.add(waterUniforms.size, 'value', 0.1, 10, 0.1).name('size');
		folderWater.add(waterUniforms.alpha, 'value', 0.9, 1, 0.001).name('alpha');
		folderWater.open();

		//
		window.addEventListener('resize', onWindowResize);
	}

	function onWindowResize() {

		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();

		renderer.setSize(window.innerWidth, window.innerHeight);

	}

	function animate() {

		requestAnimationFrame(animate);
		render();
		stats.update();

	}

	function render() {

		water.material.uniforms['time'].value += 1.0 / 60.0;
		renderer.render(scene, camera);

	}

</script>
</body>
</html>
